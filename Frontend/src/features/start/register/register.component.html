<!--
This file is part of Glotzenheft.

Glotzenheft is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Glotzenheft is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this programm.  If not, see <http://www.gnu.org/licenses/>.
-->

<div class="login">
    <div class="register">
        <form action="submit" [formGroup]="registerGroup" (ngSubmit)="registerUser()">
            <div>
                <p-floatlabel class="userInput" variant="in">
                    <input type="text" id="userName" pInputText formControlName="username" name="username" />
                    <label for="userName">Nutzername</label>
                </p-floatlabel>

                @if (registerGroup.get('username')?.invalid && hasError('username')) {
                <p-message severity="error" size="small">Nutzername ist Pflicht</p-message>
                }
            </div>

            <div>
                <p-floatlabel class="userInput" variant="in">
                    <p-password type="password" id="password" class="passInput" fluid formControlName="password"
                        name="password" [weakLabel]="'geringe Sicherheit'" [mediumLabel]="'mittlere Sicherheit'"
                        [strongLabel]="'hohe Sicherheit'" [toggleMask]="true"></p-password>
                    <label for="password">Passwort</label>
                </p-floatlabel>

                @if (registerGroup.get('password')?.invalid && hasError('password')) {
                <p-message class="formMessage" severity="error" size="small">Passwort ist Pflicht und muss mindestens 8
                    Zeichen lang
                    sein.</p-message>
                }
            </div>

            <div>
                <p-floatlabel class="userInput" variant="in">
                    <p-password type="password" id="passwordConfirm" class="passInput" fluid
                        formControlName="passwordConfirm" name="passwordConfirm" [feedback]="false"
                        [toggleMask]="true"></p-password>
                    <label for="passwordConfirm">Passwort bestätigen</label>
                </p-floatlabel>

                @if (registerGroup.get('passwordConfirm')?.invalid && hasError('password')) {
                <p-message severity="error" size="small">Das Passwort muss bestätigt werden und mit dem eingegebenen
                    Passwort übereinstimmen.</p-message>
                }
            </div>

            <div>
                <p-select formControlName="validationQuestion" [options]="questionList" optionLabel="name"
                    placeholder="Eine Frage auswählen ..." />

                @if (registerGroup.get('validationQuestion')?.invalid && hasError('validationQuestion')) {
                <p-message severity="error" size="small">Es muss eine Frage ausgewählt werden.</p-message>
                }
            </div>

            <div>
                <p-floatlabel class="userInput" variant="in">
                    <input type="text" id="answer" pInputText formControlName="validationAnswer" name="answer" />
                    <label for="answer">Antwort</label>
                </p-floatlabel>

                @if ( registerGroup.get('validationAnswer')?.invalid && hasError('validationAnswer')) {
                <p-message severity="error" size="small">Antwort ist Pflicht</p-message>
                }
            </div>

            <div>
                <p-checkbox inputId="agb" formControlName="agbAccept" [binary]="true" />
                <label for="agb" class="agbLabel">
                    Ich habe die AGB gelesen und akzeptiere diese.</label>

                @if (registerGroup.get('agbAccept')?.invalid && hasError('agbAccept')) {
                <p-message severity="error" size="small">Die AGB müssen akzeptiert werden.</p-message>
                }
            </div>
            <p-button icon="pi pi-directions" label="Hier die AGB lesen" (onClick)="openAGBDialog()" [link]="true" />

            <div class="loginActions">
                <p-button fluid label="Registrieren" icon="pi pi-user-plus" class="button2" type="submit" />
                <p-button fluid class="button2" severity="secondary" (onClick)="navigateToStartPageUseCase.execute()"
                    label="Abbrechen" icon="pi pi-times" />
            </div>
        </form>
    </div>
</div>

<p-dialog [(visible)]="isDialogVisible" header="Fehler">
    <p>
        Die Passwörter müssen übereinstimmen. Bitte überprüfen Sie Ihre Eingaben und
        versuchen Sie es erneut.
    </p>
</p-dialog>

<ng-container class="agbDialogWrapper">
    <p-dialog [(visible)]="isAGBDialogVisible">
        <app-agb />
    </p-dialog>
</ng-container>